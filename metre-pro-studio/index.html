<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MÃ©trÃ© Pro-Studio - Version 0.10</title>
    
    <!-- ===== BIBLIOTHÃˆQUES EXTERNES ===== -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="https://golden-layout.com/files/latest/js/goldenlayout.min.js"></script>
    <link type="text/css" rel="stylesheet" href="https://golden-layout.com/files/latest/css/goldenlayout-base.css" />
    <link type="text/css" rel="stylesheet" href="https://golden-layout.com/files/latest/css/goldenlayout-light-theme.css" />
    
    <!-- PDF.js for PDF viewing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // Configure PDF.js worker
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        }
    </script>

    <!-- ===== STYLES DE L'APPLICATION ===== -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components/table.css">
    <link rel="stylesheet" href="css/components/tree.css">
    <link rel="stylesheet" href="css/components/dialog.css">
    <link rel="stylesheet" href="css/components/canvas-editor.css">
    <link rel="stylesheet" href="css/components/viewer.css">
</head>
<body>

<div id="wrapper">
    <header>
        <div class="tabs-bar">
            <div class="tab active" data-tab="fichier">Fichier</div>
            <div class="tab" data-tab="affichage">Affichage</div>
            <div class="tab" data-tab="insertion">Insertion</div>
            <div class="tab" data-tab="outils">Outils</div>
            <div class="tab" data-tab="reglages">RÃ©glages</div>
            <div class="tab" data-tab="aide">Aide</div>
            <span class="toolbar-toggle" id="toolbarToggle" title="Plier/DÃ©plier la barre d'outils">â–¼</span>
        </div>
        <div class="toolbar" id="mainToolbar">
            <!-- Fichier toolbar (default) -->
            <div class="toolbar-content" data-toolbar="fichier">
                <button class="tool-btn" onclick="newProject()">ğŸ“„ Nouveau</button>
                <button class="tool-btn" onclick="openFile()">ğŸ“‚ Ouvrir</button>
                <button class="tool-btn" onclick="saveFile()">ğŸ’¾ Sauvegarder</button>
                <div class="separator"></div>
                <button class="tool-btn" onclick="importExcel()">ğŸ“Š Importer Excel</button>
                <button class="tool-btn" onclick="exportExcel()">ğŸ“¤ Exporter Excel</button>
                <div class="separator"></div>
                <button class="tool-btn" onclick="printProject()">ğŸ–¨ï¸ Imprimer</button>
            </div>
            
            <!-- Affichage toolbar -->
            <div class="toolbar-content" data-toolbar="affichage" style="display: none;">
                <span style="font-size: 11px; color: #666; margin-right: 10px;">Panneaux :</span>
                <button class="tool-btn" onclick="showPanel('tree')">ğŸ“ Explorateur</button>
                <button class="tool-btn" onclick="showPanel('metre')">ğŸ“ MÃ©trÃ©</button>
                <button class="tool-btn" onclick="showPanel('variables')">ğŸ”¢ Variables L-S-V</button>
                <button class="tool-btn" onclick="showPanel('viewer')">ğŸ‘ï¸ Visionneuse</button>
                <div class="separator"></div>
                <span style="font-size: 11px; color: #666; margin-right: 10px;">Zoom :</span>
                <button class="tool-btn" onclick="zoomIn()">ğŸ”+ Zoom +</button>
                <button class="tool-btn" onclick="zoomOut()">ğŸ”âˆ’ Zoom âˆ’</button>
                <button class="tool-btn" onclick="zoomReset()">â†º 100%</button>
            </div>
            
            <!-- Insertion toolbar -->
            <div class="toolbar-content" data-toolbar="insertion" style="display: none;">
                <span style="font-size: 11px; color: #666; margin-right: 10px;">Blocs :</span>
                <button class="tool-btn" onclick="addBlockToCurrentPoste('file')">ğŸ“ Poste</button>
                <button class="tool-btn" onclick="addBlockToCurrentPoste('table')">ğŸ“Š Tableau</button>
                <button class="tool-btn" onclick="addBlockToCurrentPoste('canvas')">ğŸ¨ Canvas</button>
                <button class="tool-btn" onclick="addBlockToCurrentPoste('image')">ğŸ“· Images</button>
                <div class="separator"></div>
                <span style="font-size: 11px; color: #666; margin-right: 10px;">Structure :</span>
                <button class="tool-btn" onclick="addNewFolder(currentProjectId)">ğŸ“ Dossier</button>
                <button class="tool-btn" onclick="addPoste(currentProjectId)">ğŸ“„ Fichier</button>
            </div>
            
            <!-- Outils toolbar -->
            <div class="toolbar-content" data-toolbar="outils" style="display: none;">
                <button class="tool-btn" onclick="showVariableManager()">ğŸ”¢ Gestionnaire de variables</button>
                <button class="tool-btn" onclick="showSearchReplace()">ğŸ” Rechercher/Remplacer</button>
                <div class="separator"></div>
                <button class="tool-btn" onclick="validateFormulas()">âœ“ Valider les formules</button>
                <button class="tool-btn" onclick="showCalculator()">ğŸ§® Calculatrice</button>
            </div>
            
            <!-- RÃ©glages toolbar -->
            <div class="toolbar-content" data-toolbar="reglages" style="display: none;">
                <button class="tool-btn" onclick="openSettings()">âš™ï¸ PrÃ©fÃ©rences</button>
                <button class="tool-btn" onclick="showShortcutsSettings()">âŒ¨ï¸ Raccourcis clavier</button>
                <div class="separator"></div>
                <button class="tool-btn" onclick="showUnitsSettings()">ğŸ“ UnitÃ©s</button>
                <button class="tool-btn" onclick="showDisplaySettings()">ğŸ¨ Apparence</button>
            </div>
            
            <!-- Aide toolbar -->
            <div class="toolbar-content" data-toolbar="aide" style="display: none;">
                <button class="tool-btn" onclick="showHelp()">â“ Aide</button>
                <button class="tool-btn" onclick="showShortcuts()">âŒ¨ï¸ Raccourcis clavier</button>
                <button class="tool-btn" onclick="showAbout()">â„¹ï¸ Ã€ propos</button>
                <div class="separator"></div>
                <button class="tool-btn" onclick="showTutorial()">ğŸ“ Tutoriel</button>
                <button class="tool-btn" onclick="checkUpdates()">ğŸ”„ VÃ©rifier les mises Ã  jour</button>
            </div>
        </div>
    </header>

    <div class="project-tabs-container" id="projectTabs"></div>
    
    <div id="projects-container">
        <div class="empty-state" id="emptyState">
            <div>Aucun projet ouvert</div>
            <button class="tool-btn" onclick="newProject()">ğŸ“„ CrÃ©er un nouveau projet</button>
        </div>
    </div>

    <footer>
        <div style="display: flex; align-items: center; gap: 10px;">
            <div id="days-remaining" style="color: #666; font-weight: 500; cursor: pointer;" title="Double-clic pour modifier la date"></div>
            <div class="status-info">
                Somme sÃ©lection : <strong id="sum-val">0.00</strong> | Cellules : <strong id="cell-count">0</strong>
            </div>
        </div>
        <div class="zoom-control" style="display: flex; align-items: center; gap: 5px;">
            <span>Zoom :</span>
            <button id="zoomOut" style="padding: 4px; width: 20px; height: 20px; font-size: 16px; cursor: pointer; border: 1px solid #ccc; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center;">âˆ’</button>
            <input type="range" min="10" max="400" value="100" id="zoomSlider">
            <button id="zoomIn" style="padding: 4px; width: 20px; height: 20px; font-size: 16px; cursor: pointer; border: 1px solid #ccc; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center;">+</button>
            <span id="zoomText">100%</span>
        </div>
    </footer>
</div>

<!-- Dialog overlay -->
<div class="dialog-overlay" id="dialogOverlay">
    <div class="dialog-box" id="dialogBox"></div>
</div>

<!-- Settings overlay -->
<div class="settings-overlay" id="settingsOverlay">
    <div class="settings-window">
        <div class="settings-header">
            <h2>âš™ï¸ RÃ©glages</h2>
            <button class="settings-close" onclick="closeSettings()">âœ–</button>
        </div>
        <div class="settings-body">
            <div class="settings-sidebar" id="settingsSidebar">
                <div class="settings-menu-item active" data-section="general">GÃ©nÃ©ral</div>
                <div class="settings-menu-item" data-section="display">Affichage</div>
                <div class="settings-menu-item" data-section="theme">ThÃ¨me</div>
                <div class="settings-menu-item" data-section="tags">Tags</div>
                <div class="settings-menu-item" data-section="units">UnitÃ©s</div>
                <div class="settings-menu-item" data-section="format">Format</div>
                <div class="settings-menu-item" data-section="ai">IA</div>
                <div class="settings-menu-item" data-section="export">Export</div>
                <div class="settings-menu-item" data-section="advanced">AvancÃ©</div>
            </div>
            <div class="settings-content" id="settingsContent"></div>
        </div>
        <div class="settings-footer">
            <button class="settings-btn" onclick="closeSettings()">Annuler</button>
            <button class="settings-btn primary" onclick="saveSettings()">Enregistrer</button>
        </div>
    </div>
</div>

<!-- Debug Console -->
<div class="debug-console" id="debugConsole">
    <div class="debug-header">
        <h3>ğŸ› Console de DÃ©bogage</h3>
        <button class="settings-close" onclick="toggleDebugConsole()">âœ–</button>
    </div>
    <div class="debug-content" id="debugContent"></div>
</div>

<!-- Canvas Editor Overlay -->
<div class="canvas-editor-overlay" id="canvasEditorOverlay">
    <div class="canvas-editor">
        <div class="canvas-editor-header">
            <div class="canvas-editor-title">ğŸ¨ Ã‰diteur de Canvas</div>
            <button class="canvas-editor-close" onclick="closeCanvasEditor()">Fermer</button>
        </div>
        <div class="canvas-editor-toolbar">
            <div class="canvas-tool-group">
                <button class="canvas-tool-btn active" data-tool="pen" title="Crayon">âœï¸</button>
                <button class="canvas-tool-btn" data-tool="eraser" title="Gomme">ğŸ§¹</button>
                <button class="canvas-tool-btn" data-tool="line" title="Ligne">ğŸ“</button>
                <button class="canvas-tool-btn" data-tool="rect" title="Rectangle">â–­</button>
                <button class="canvas-tool-btn" data-tool="circle" title="Cercle">â­•</button>
                <button class="canvas-tool-btn" data-tool="arrow" title="FlÃ¨che">â¡ï¸</button>
                <button class="canvas-tool-btn" data-tool="text" title="Texte">ğŸ“</button>
            </div>
            <div class="canvas-tool-group">
                <label style="font-size: 11px; margin-right: 5px;">Couleur:</label>
                <input type="color" id="canvasColor" class="canvas-tool-input" value="#000000" style="width: 50px; height: 30px;">
            </div>
            <div class="canvas-tool-group">
                <label style="font-size: 11px; margin-right: 5px;">Ã‰paisseur:</label>
                <input type="range" id="canvasLineWidth" class="canvas-tool-input" min="1" max="20" value="2" style="width: 100px;">
                <span id="lineWidthValue" style="font-size: 11px; min-width: 25px;">2px</span>
            </div>
            <div class="canvas-tool-group">
                <button class="canvas-tool-btn" onclick="uploadImageToCanvas()" title="Importer image">ğŸ–¼ï¸ Image</button>
                <button class="canvas-tool-btn" onclick="toggleCanvasGrid()" title="Grille">ğŸ“</button>
                <button class="canvas-tool-btn" onclick="clearCanvas()" title="Effacer tout">ğŸ—‘ï¸</button>
            </div>
            <div class="canvas-tool-group">
                <button class="canvas-tool-btn" onclick="undoCanvas()" title="Annuler">â†¶</button>
                <button class="canvas-tool-btn" onclick="redoCanvas()" title="Refaire">â†·</button>
            </div>
            <div class="canvas-tool-group">
                <button class="canvas-tool-btn" onclick="saveCanvasAndClose()" title="Sauvegarder" style="background: #27ae60; color: white; font-weight: bold;">ğŸ’¾ Sauvegarder</button>
            </div>
        </div>
        <div class="canvas-editor-workspace">
            <div class="canvas-editor-main">
                <div class="canvas-container" id="canvasContainer">
                    <canvas id="canvasEditor" width="800" height="600"></canvas>
                </div>
            </div>
            <div class="canvas-editor-sidebar">
                <h3 style="margin: 0 0 10px 0; font-size: 13px; color: #34495e;">ğŸ“‹ PropriÃ©tÃ©s</h3>
                <div style="margin-bottom: 15px;">
                    <label style="font-size: 11px; font-weight: bold; display: block; margin-bottom: 5px;">Titre du canvas:</label>
                    <input type="text" id="canvasTitle" class="canvas-tool-input" style="width: 100%;" placeholder="Ex: DÃ©tail faÃ§ade">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="font-size: 11px; font-weight: bold; display: block; margin-bottom: 5px;">Dimensions:</label>
                    <div style="display: flex; gap: 5px; align-items: center;">
                        <input type="number" id="canvasWidth" class="canvas-tool-input" value="800" style="width: 60px;" min="200" max="2000">
                        <span style="font-size: 11px;">Ã—</span>
                        <input type="number" id="canvasHeight" class="canvas-tool-input" value="600" style="width: 60px;" min="200" max="2000">
                        <button class="canvas-tool-btn" onclick="resizeCanvas()" style="font-size: 10px;">âœ“</button>
                    </div>
                </div>
                <div>
                    <label style="font-size: 11px; font-weight: bold; display: block; margin-bottom: 5px;">Fond:</label>
                    <input type="color" id="canvasBackground" class="canvas-tool-input" value="#ffffff" style="width: 100%; height: 35px;">
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ===== JAVASCRIPT DE L'APPLICATION ===== -->
<script src="js/app.js"></script>

</body>
</html>
